<!DOCTYPE html>
<html lang="es" class="weatherApp">
<head>
    <meta charset="UTF-8">
    <title>Weather App</title>
    <link rel="stylesheet/less" type="text/css" href="css/weatherapp.less"/>
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="js/AccuWeather.js"></script>
</head>
<body style="height: 945px;">
<div id="forecastContainer">
    <div id="currentCity">
        <form action="" id="cityForm">
            <input type="text" id="cityName" class="cityInput" placeholder="Ciudad" autocomplete="off">
            <input id="getCity" class="cityInput" type="submit" value="Buscar">
        </form>
        <div class="hourlyForecasts24 gradient-background">
            <div class="hourForeCast">
                <div class="hour hourForeCast-element"> 11 p. m.</div>
                <div class="weatherIcon weatherIcon-1 hourForeCast-element"></div>
                <div class="temperature hourForeCast-element">6º</div>
                <div class="temperatureGrpahic hourForeCast-element">
                    <div class="currentTemperatureHeight"></div>
                </div>
                <div class="humidity">2%</div>
            </div>
            <div class="hourForeCast">
                <div class="hour hourForeCast-element"> 11 p. m.</div>
                <div class="weatherIcon weatherIcon-1 hourForeCast-element"></div>
                <div class="temperature hourForeCast-element">6º</div>
                <div class="temperatureGrpahic hourForeCast-element">
                    <div class="currentTemperatureHeight"></div>
                </div>
                <div class="humidity">2%</div>
            </div>
            <div class="hourForeCast">
                <div class="hour hourForeCast-element"> 11 p. m.</div>
                <div class="weatherIcon weatherIcon-1 hourForeCast-element"></div>
                <div class="temperature hourForeCast-element">6º</div>
                <div class="temperatureGrpahic hourForeCast-element">
                    <div class="currentTemperatureHeight"></div>
                </div>
                <div class="humidity">2%</div>
            </div>
            <div class="hourForeCast">
                <div class="hour hourForeCast-element"> 11 p. m.</div>
                <div class="weatherIcon weatherIcon-1 hourForeCast-element"></div>
                <div class="temperature hourForeCast-element">6º</div>
                <div class="temperatureGrpahic hourForeCast-element">
                    <div class="currentTemperatureHeight"></div>
                </div>
                <div class="humidity">2%</div>
            </div>
            <div class="hourForeCast">
                <div class="hour hourForeCast-element"> 11 p. m.</div>
                <div class="weatherIcon weatherIcon-1 hourForeCast-element"></div>
                <div class="temperature hourForeCast-element">6º</div>
                <div class="temperatureGrpahic hourForeCast-element">
                    <div class="currentTemperatureHeight"></div>
                </div>
                <div class="humidity">2%</div>
            </div>
            <div class="hourForeCast">
                <div class="hour hourForeCast-element"> 11 p. m.</div>
                <div class="weatherIcon weatherIcon-1 hourForeCast-element"></div>
                <div class="temperature hourForeCast-element">6º</div>
                <div class="temperatureGrpahic hourForeCast-element">
                    <div class="currentTemperatureHeight"></div>
                </div>
                <div class="humidity">2%</div>
            </div>
            <div class="hourForeCast">
                <div class="hour hourForeCast-element"> 11 p. m.</div>
                <div class="weatherIcon weatherIcon-1 hourForeCast-element"></div>
                <div class="temperature hourForeCast-element">6º</div>
                <div class="temperatureGrpahic hourForeCast-element">
                    <div class="currentTemperatureHeight"></div>
                </div>
                <div class="humidity">2%</div>
            </div>
        </div>
        <div class="weeklyForecasts gradient-background">
            <div class="dayForeCast">
                <div class="dayWeek">lunes</div>
                <div class="dayStats">
                    <div class="humidity">2%</div>
                    <div class="weatherDayNight">
                        <div class="weatherIcon weatherIcon-1"></div>
                        <div class="weatherIcon weatherIcon-33"></div>
                    </div>
                    <div class="maxTminT">
                        <div class="maxTemp">12º</div>
                        <div class="minTemp">1º</div>
                    </div>
                </div>
            </div>
            <div class="dayForeCast">
                <div class="dayWeek">Hoy</div>
                <div class="dayStats">
                    <div class="humidity">2%</div>
                    <div class="weatherDayNight">
                        <div class="weatherIcon weatherIcon-1"></div>
                        <div class="weatherIcon weatherIcon-33"></div>
                    </div>
                    <div class="maxTminT">
                        <div class="maxTemp">12º</div>
                        <div class="minTemp">1º</div>
                    </div>
                </div>
            </div>
            <div class="dayForeCast">
                <div class="dayWeek">martes</div>
                <div class="dayStats">
                    <div class="humidity">2%</div>
                    <div class="weatherDayNight">
                        <div class="weatherIcon weatherIcon-1"></div>
                        <div class="weatherIcon weatherIcon-33"></div>
                    </div>
                    <div class="maxTminT">
                        <div class="maxTemp">12º</div>
                        <div class="minTemp">1º</div>
                    </div>
                </div>
            </div>
            <div class="dayForeCast">
                <div class="dayWeek">miércoles</div>
                <div class="dayStats">
                    <div class="humidity">2%</div>
                    <div class="weatherDayNight">
                        <div class="weatherIcon weatherIcon-1"></div>
                        <div class="weatherIcon weatherIcon-33"></div>
                    </div>
                    <div class="maxTminT">
                        <div class="maxTemp">12º</div>
                        <div class="minTemp">1º</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="cityList">
        <div class="cityInfo gradient-background">
            <div class="todayInfo">
                <div class="todayInfoLeft">
                    <div class="dayTemperature">12.2º</div>
                    <div class="cityAndState">
                        <div class="cityName">Alcorcón</div>
                        <div class="stateName">Comunidad de Madrid</div>
                    </div>
                    <div class="maxTminTHumidity">
                        <div class="tempMax">20º</div>
                        <div class="tempMin">17º</div>
                        <div class="humidity">Humedad: 48</div>
                    </div>
                </div>
                <div class="weatherIcon weatherIcon-1"></div>
            </div>
            <div class="nextDays">
                <div class="oneDayAfter">
                    <div class="weatherIcon weatherIcon-1"></div>
                    <div class="dayAfterInfo">
                        <div class="weekDay">Viernes</div>
                        <div class="nextDaysTemperatures">
                            <div class="tempMax">20º</div>
                            <div class="tempMin">17º</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module" src="js/registerServiceWorker.js"></script>
<script>
    function getOffset(el) {
        let rect = el.getBoundingClientRect();
        return {
            left: rect.left + window.pageXOffset,
            top: rect.top + window.pageYOffset,
            width: rect.width || el.offsetWidth,
            height: rect.height || el.offsetHeight
        };
    }

    function connect(div1, div2) { // draw a line connecting elements
        let off1 = getOffset(div1[0]);
        let off2 = getOffset(div2[0]);
        // bottom right
        let x1 = off1.left + off1.width;
        let y1 = off1.top + off1.height;
        // top right
        let x2 = off2.left + off2.width;
        let y2 = off2.top;
        // distance
        let length = Math.sqrt(((x2 - x1) * (x2 - x1)) + ((y2 - y1) * (y2 - y1)));
        // center
        let cx = ((x1 + x2) / 2) - (length / 2);
        let cy = ((y1 + y2) / 2) - (3 / 2);
        // angle
        let angle = Math.atan2((y1 - y2), (x1 - x2)) * (180 / Math.PI);
        // make hr
        let htmlLine = `<div style="padding:0px; margin:0px; height:3px; background-color: white; line-height:1px;
            position:absolute; left:${cx}px; top:${cy}px; width:${length}px; -moz-transform:rotate(${angle}deg);
            -webkit-transform:rotate(${angle}deg); -o-transform:rotate(${angle}deg); -ms-transform:rotate(${angle}deg);
            transform:rotate(${angle}deg);">`;
        document.body.innerHTML += htmlLine;
    }
</script>
<script>
    $(document).ready(function () {
        let weather = AccuWeather.getInstance();
        const form = document.querySelector("#cityForm");
        city = null;
        form.addEventListener("submit", e => {
            e.preventDefault();
            let cityName = $('#cityName')[0].value;
            form.reset();
            $('#cityName').focus();
            weather.getWeatherCiy(cityName, true)
                .then(data => {
                    city = data;
                    console.log(data)
                    $('.listadoCiudades').append(`<li>En ${cityName} es ${data.IsDayTime ? 'de día' : 'de noche'},
                    está ${data.WeatherText} y hace una temperatura de ${data.ApparentTemperature.Metric.Value}
                    ${data.ApparentTemperature.Metric.Unit}</li>`);
                })
                .catch(error => console.log(error));
        });
        // input.addEventListener('input', e => {
        //     e.preventDefault();
        //     let cityName = $('#cityName')[0].value;
        //     let listadoCiudades = $('#posiblesCiudades');
        //     weather.autocompleteSearch(cityName).then(data => {
        //         listadoCiudades.empty();
        //         data.forEach(city => {
        //             listadoCiudades.append(`<option key="${city.Key}">${city.LocalizedName},
        //             ${city.AdministrativeArea.LocalizedName}</option>`);
        //         });
        //     })
        //         .catch(error => {
        //             listadoCiudades.empty();
        //             console.log(`No se ha encontrado ninguna ciudad con esa palabra. ${error}`)
        //         });
        // });
    });
</script>
</body>
</html>